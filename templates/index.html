{% extends 'base.html' %}
{% block main %}
<main>
    {% include './partials/_form.html' %}

    <div id="tasks">
        <p id="dialog"></p>
    </div>
    <p>{{ data }}</p>
    <p id="demo"></p>
    <div id="map"></div>
    <p id="geocode"></p>
</main>
{% endblock main %}

{% block javascript %}
<script>
function getdataform() {
    var h = document.getElementById("address").value;
    var data = document.getElementById("dialog");
    data.insertAdjacentHTML("beforeend", "<br>" + h);
};

function bot(data) {
    var p = document.getElementById("dialog");
    p.insertAdjacentHTML("beforeend", "<br>" + "salut c' est papy bot alors ladresse est:" + data);
}



function loadDoc(event) {
    event.preventDefault();
  const xhttp = new XMLHttpRequest();
  xhttp.onload = function() {
    document.getElementById("map").innerHTML = this.responseText;
  }
  xhttp.open("POST", "");
  xhttp.send();
}


$(document).ready(function() {
     $('form').on('submit', function(event) {
       $.ajax({
          data : {
             address : $('#address').val(),
                 },
             type : 'POST',
             url : '/ajaxtest'
            })
        .done(function(data) {
          $('#output').text(data.output).show();
            dataApi = JSON.stringify(data);
            console.log(dataApi);
            setTimeout(function() {
                bot(data.output);
            }, 1000);

          (function (geocode){
            let mapElement = 'map';
            let address = dataApi;
            geocoder = new google.maps.Geocoder();
           geocoder.geocode({ 'address': address }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
              var mapOptions = {
                  zoom: 14,
                  center: results[0].geometry.location,
                  disableDefaultUI: true
              };
              var map = new google.maps.Map(document.getElementById(mapElement), mapOptions);
              var marker = new google.maps.Marker({
                  map: map,
                  position: results[0].geometry.location
              });
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
          });
        })();

      });
      event.preventDefault();
      });
});

</script>
{% endblock javascript %}

function geocodeAddress(geocoder, resultsMap) {
  const address = document.getElementById("address").value;
  geocoder.geocode({ address: address }, (results, status) => {
    if (status === "OK") {
      resultsMap.setCenter(results[0].geometry.location);
      new google.maps.Marker({
        map: resultsMap,
        position: results[0].geometry.location,
      });
    } else {
      alert("Geocode was not successful for the following reason: " + status);
    }
  });
}
https://maps.googleapis.com/maps/api/staticmap?center=
  "+48.90624,2.2478848+"&zoom=14&size=400x300&sensor=false&key=AIzaSyAB3wGZqVllOeyAlTzVarXmnlAOT5Kk2Eg

function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 8,
    center: { lat: 48.8534, lng: 2.3488 },
  });
  const geocoder = new google.maps.Geocoder();
  document.getElementById("submit").addEventListener("click", () => {
    geocodeAddress(geocoder, map);
  });
}

<!--<a href="{{ url_for('update', id=task.id) }}">Update</a> -->
<!--<a href="{{ url_for('delete', id=task.id) }}">Delete</a> -->

var geocode = '{{ data[0] }}';
document.getElementById("geocode").innerHTML = geocode;